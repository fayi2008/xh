<!DOCTYPE HTML>
<html>
<head>
    <title> 资源文件结构</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link href="/assets/css/bs3/dpl-min.css" rel="stylesheet" type="text/css"/>
    <link href="/assets/css/bs3/bui-min.css" rel="stylesheet" type="text/css"/>
    <link href="/assets/css/page-min.css" rel="stylesheet" type="text/css"/>   <!-- 下面的样式，仅是为了显示代码，而不应该在项目中使用-->
    <link href="/assets/css/prettify.css" rel="stylesheet" type="text/css"/>
    <link href="/assets/css/hqtec.css" rel="stylesheet">
    <style type="text/css">
        code {
            padding: 0px 4px;
            color: #d14;
            background-color: #f7f7f9;
            border: 1px solid #e1e1e8;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="row">
        <form id="J_Form" class="form-horizontal span24" action='/Gis/admin/poi' method='post'>
            <div class="row">
                <div class="control-group span8">
                    <label class="control-label"><s>*</s>名称：</label>

                    <div class="controls">
                        <input name="NAME" type="text" data-rules="{required:true}" class="input-normal control-text">
                    </div>
                </div>
                <div class="control-group span8">
                    <label class="control-label"><s>*</s>类型：</label>

                    <div class="controls">
                        <select data-rules="{required:true}" name="TYPE" id="TYPE" class="input-normal">
                            <option value="">请选择</option>
                            <option value="1">商户</option>
                            <option value="2">景点</option>
                            <option value="3">公众设施</option>
                            <option value="4">厕所</option>
                            <option value="5">空中全景</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row" id="span_wrap">
                <div style="display: none" id="tag">
                    <div class="control-group span24">
                        <label class="control-label">标签：</label>

                        <div class="bui-form-group controls "
                             style='height: auto; margin-bottom: 15px;' data-rules="{}"
                             data-messages="{}">
                            <foreach name="tag" item="vo" key="key">
                                <if
                                        condition="( ($key%5) eq 0) AND ($key neq 0)">
                                    <br/>
                                </if>
                                <label class="checkbox"><input name="TAG_IDS[]"
                                                               type="checkbox" value="{$vo.id}"/>{$vo.name}</label>
                            </foreach>
                        </div>
                    </div>
                </div>
                <div style="display: none" id="business">
                    <div class="control-group span24">
                        <label class="control-label">标签：</label>

                        <div class="bui-form-group controls "
                             style='height: auto; margin-bottom: 15px;' data-rules="{}"
                             data-messages="{}">


                            <label class="checkbox"><input name="TAG_IDS[]"
                                                           type="checkbox" value="1"/>住宿</label> <label
                                class="checkbox"><input
                                name="TAG_IDS[]" type="checkbox" value="2"/>餐饮</label>

                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="control-group span8">
                    <label class="control-label"><s>*</s>纬度：</label>

                    <div class="controls">
                        <input name="LAT" type="text" data-rules="{required:true}" class="input-normal control-text">
                    </div>
                </div>

                <div class="control-group span8">
                    <label class="control-label"><s>*</s>经度：</label>

                    <div class="controls">
                        <input name="LON" type="text" data-rules="{required:true}" class="input-normal control-text">
                    </div>
                </div>
                <span><a href="http://lbs.qq.com/tool/getpoint/index.html" class="button" target="_blank">坐标拾取器</a></span>
            </div>


            <div class="row">
                <label class="control-label control-image">图片：</label>
                <div class="span8">
                    <div id="J_Uploader">
                        <input type="hidden" name='IMAGE' value='' id='IMAGE'>
                    </div>
                </div>
            </div>
            <div class="row">

                <label class="control-label control-image">多图：</label>

                <div class="control-group span12">
                    <div id="J_Uploader2">
                        <input type="hidden" name='MANY_IMAGE' value='' id='MANY_IMAGE'>
                    </div>
                </div>

            </div>


            <div class="row">
                <div class="control-group span24">
                    <label class="control-label"><s>*</s>地区：</label>

                    <div class="bui-form-group-select controls" data-url="../admin/city.json">
                        <select name="province" value="1">
                            <option>请选择省</option>
                        </select>
                        <select name="city" value="12">
                            <option>请选择市</option>
                        </select>
                        <select data-rules="{required:true}" name="AREA" value="121">
                            <option>请选择县/区</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="control-group span12">
                    <label class="control-label">具体地址：</label>
                    <div class="controls">
                        <input name="ADDRESS" style="width:300px" type="text" class="input-normal control-text">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="control-group span8">
                    <label class="control-label">权重：</label>
                    <div class="controls">
                        <input name="POWER" type="text" class="input-normal control-text">
                    </div>
                </div>
                <div class="control-group span8">
                    <label class="control-label">简称：</label>

                    <div class="controls">
                        <input name="SHORT_NAME" type="text" class="input-normal control-text">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="control-group span24">
                    <label class="control-label">描述：</label>
                    <div class="controls control-row4">
                        <textarea name="DESCRIPTION" id="DESC" class="span8 span-width"></textarea>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="control-group span24">
                    <label class="control-label">语音介绍文件：</label>
                    <div class="controls" style="height: auto;" >
                        <div id="J_Uploader3" style="margin-bottom: 10px;" >
                            <input type="hidden" name='VOICE_PATH' value='' id='VOICE_PATH'>
                        </div>
                    </div>
                    <span>注：不上传语音文件会自动把文字转换成语音</span>
                </div>
            </div>
            <div class="row">
                <div class="control-group span15">
                    <label class="control-label">状态：</label>
                    <div class="controls">
                        <select name="STATUS" class="input-normal">
                            <option value="0">取消</option>
                            <option value="1">发布</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="form-actions offset3">
                    <button type="submit" class="button button-save">保存</button>

                </div>
            </div>
        </form>
    </div>


</div>
<script type="text/javascript" src="/assets/js/jquery-1.8.1.min.js?{$js_version}"></script>
<script type="text/javascript" src="/assets/js/bui-min.js?{$js_version}"></script>

<script type="text/javascript" src="/assets/js/config-min.js?{$js_version}"></script>
<script type="text/javascript">
    BUI.use('common/page');
</script>
<!-- 仅仅为了显示代码使用，不要在项目中引入使用-->
<script type="text/javascript" src="/assets/js/prettify.js?{$js_version}"></script>
<script type="text/javascript">
    $(function () {
        prettyPrint();
    });
    $('#PROVINCE').on('change', function () {
        var PROVINCE = $("#PROVINCE").val();
        $.ajax({
            type: "GET",
            url: "{:U('poi_city')}" + '?probince_id=' + PROVINCE,
            success: function (data) {
                $("#PROVINCE").empty();
                $("#PROVINCE").append("<option value='0'>请选择市</option>");
                var json = JSON.parse(data);
                for (var i = 0; i < json.length; i++) {
                    $("#package_id").append("<option value='" + json[i].id + "'>" + json[i].name + "</option>");
                }

            }
        });
    })


    function selectSpan() {
        var type = $("#TYPE").val();
        if (type == "2") {

            $("#tag").css("display", "block").appendTo($('#span_wrap'));
            $("#business").css("display", "none").appendTo('body');

        } else if (type == "1") {

            $("#business").css("display", "block").appendTo($('#span_wrap'));
            $("#tag").css("display", "none").appendTo('body');
            ;
        } else {
            $("#tag").css("display", "none").appendTo('body');
            $("#business").css("display", "none").appendTo('body');
        }
    }

    $('#TYPE').on('change', function () {
        selectSpan();
    });


</script>
<script type="text/javascript">
    BUI.use('bui/form', function (Form) {
        new Form.HForm({
            srcNode: '#J_Form',
            submitType: 'ajax',
            callback: function (data) {
                if (data.status == 1) {

                    BUI.Message.Alert('添加成功', function () {
                        top.topManager.closePage();
                        window.location.href = data.data;
                    }, 'success');


                } else {
                    BUI.Message.Alert(data.msg, function () {
                        window.location.href = data.data;
                    }, 'error');
                }
            }
        }).render();


    });
</script>

<script type="text/javascript">
    BUI.use('bui/uploader', function (Uploader) {

        /**
         * 返回数据的格式
         *
         *  默认是 {url : 'url'},否则认为上传失败
         *  可以通过isSuccess 更改判定成功失败的结构
         */

            //添加自定义主题
        Uploader.Theme.addTheme('imageView', {
            elCls: 'imageViewTheme',
            //可以设定该主题统一的上传路径
            // url: '../../../test/upload/upload.php',
            queue: {
                //结果的模板，可以根据不同状态进进行设置
                resultTpl: {
                    'default': '<div class="default">{name}</div>',
                    'success': '<div class="success"><img style="width: 100%;height: 100%;" src="/upload/{file}" /></div>',
                    'error': '<div class="error"><span class="uploader-error">{msg}</span></div>',
                    'progress': '<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'
                },
                listeners: {
                    itemremoved: function (ev) {
                        $("#IMAGE").val('');
                    }
                }
            }
        });
        var uploader = new Uploader.Uploader({
            theme: 'imageView',
            render: '#J_Uploader',
            url: 'http://{$httphost}/index.php/Gis/admin/upload/',
            //可以直接在这里直接设置成功的回调
            success: function (result) {
            },
            isSuccess: function (result) {

                if (result.status) {
                    return true;
                }
                return false;
            },
            //失败的回调
            error: function (result) {
            },
            rules: {
                //文的类型
                ext: ['.png,.jpg', '文件类型只能为{0}'],
                //上传的最大个数
                max: [2, '文件的最大个数不能超过1个'],
                //文件大小的最小值,这个单位是kb
                minSize: [1, '文件的大小不能小于{0}KB'],
                //文件大小的最大值,单位也是kb
                maxSize: [1024, '文件大小不能大于1M']
            }
        }).render();

        //上传成功时会触发
        uploader.on('success', function (ev) {
            var result = ev.result;
            $("#IMAGE").val(result.file);
        })
        //上传文件改变时
        uploader.on('change', function (ev) {
            var items = ev.items;
            var queue = uploader.get('queue');
            for (var i in items) {
                if (items[i].error == true) {
                    queue.clearItems();
                    BUI.Message.Alert(items[i].name + items[i].msg, 'error');
                } else {
                    queue.setItems([items[i]]);
                }
            }
        })
        //上传失败时会触发
        uploader.on('error', function (ev) {
            var result = ev.result;
            uploader.get('queue').clearItems();
            BUI.Message.Alert('上传失败' + result.msg, 'error');
        });
        //上传声音文件样式主题
        Uploader.Theme.addTheme('voiceView', {
            elCls: 'voiceViewTheme',
            //可以设定该主题统一的上传路径
            // url: '../../../test/upload/upload.php',
            queue: {
                //结果的模板，可以根据不同状态进进行设置
                resultTpl: {
                    'default': '<div class="default">{name}</div>',
                    'success': '<span class="success">/upload/{file}</span>',
                    'error': '<span class="error"><span class="uploader-error">{msg}</span></span>',
                    'progress': '<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'
                },
                listeners: {
                    itemremoved: function (ev) {
                        $("#VOICE_PATH").val('');
                    }
                }
            }
        });
        //上传声音文件
        var voice_uploader = new Uploader.Uploader({
            theme: 'voiceView',
            render : '#J_Uploader3',
            url : 'http://{$httphost}/index.php/Gis/admin/upload',
            data :{dirname:'voice','exts':['ogg','mp3','wav']},
            //可以直接在这里直接设置成功的回调
            success : function(result) {
            },
            isSuccess : function(result) {
                if (result.status) {
                    return true;
                }
                return false;
            },
            //失败的回调
            error : function(result) {
            },
            rules: {
                //文的类型
                ext: ['.ogg,.mp3,.wav','文件类型只能为{0}'],
                //上传的最大个数
                max: [1, '文件的最大个数不能超过{0}个'],
                //文件大小的最小值,这个单位是kb
                minSize: [1, '文件的大小不能小于{0}KB'],
                //文件大小的最大值,单位也是kb
                maxSize: [51200, '文件大小不能大于50M']
            }
        }).render();

        //上传成功时会触发
        voice_uploader.on('success', function(ev) {
            var result = ev.result;
            $("#VOICE_PATH").val(result.file);

        });

        //上传失败时会触发
        voice_uploader.on('error', function(ev) {
            var result = ev.result;
            BUI.Message.Alert('上传失败,原因：'.result,'error');
        });

    });
    var file = [];
    BUI.use('bui/uploader',function (Uploader) {
                        //添加自定义主题
                        Uploader.Theme.addTheme('imageView', {
                                            elCls: 'imageViewTheme',
                                            //可以设定该主题统一的上传路径
                                            // url: '../../../test/upload/upload.php',
                                            queue: {
                                                //结果的模板，可以根据不同状态进进行设置
                                                resultTpl: {
                                                    'default': '<div class="default">{name}</div>',
                                                    'success': '<div class="success"><img style="width: 100%;height: 100%;" src="/upload/{file}" /><input type="hidden" name="MANY_IMAGE[]" value="{file}"/></div>',
                                                    'error': '<div class="error"><span class="uploader-error">{msg}</span></div>',
                                                    'progress': '<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'
                                                }
                                            }});

                        /**
                         * 返回数据的格式
                         *
                         *  默认是 {url : 'url'},否则认为上传失败
                         *  可以通过isSuccess 更改判定成功失败的结构
                         */
                        var uploader = new Uploader.Uploader({
                            theme: 'imageView',
                            render: '#J_Uploader2',
                            // url : '/index.php/Panorama/admin/upload/',
                            url: 'http://{$httphost}/index.php/Gis/admin/upload/',
                            //可以直接在这里直接设置成功的回调
                            success: function (result) {
                            },
                            isSuccess: function (result) {

                                if (result.status) {
                                    return true;
                                }
                                return false;
                            },
                            //失败的回调
                            error: function (result) {
                            },
                            rules: {
                                //文的类型
                                ext: ['.png,.jpg', '文件类型只能为{0}'],
                                //上传的最大个数
                                max: [5, '文件的最大个数不能超过{0}个'],
                                //文件大小的最小值,这个单位是kb
                                minSize: [10, '文件的大小不能小于{0}KB'],
                                //文件大小的最大值,单位也是kb
                                maxSize: [1024, '文件大小不能大于1M']
                            }
                        }).render();

                        //上传成功时会触发
                        uploader.on('success', function (ev) {
                            var result = ev.result;
                            file.push(result.file);
                        })

                        //上传成功时会触发
                        uploader.on('error', function (ev) {
                            var result = ev.result;
                            BUI.Message.Alert('上传失败', 'error');
                        });
                    });
</script>
</body>
</html> 